name: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥é€ä¿¡

on:
  workflow_run:
    workflows:
      - "æ¥½å¤©ROOMè‡ªå‹•æŠ•ç¨¿"
      - "æ¥½å¤©å¸‚å ´APIå¤‰æ›´æ¤œå‡º"
    types:
      - completed

jobs:
  notify-email:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: Pythonã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install python-dotenv
      
      - name: æŠ•ç¨¿å®Œäº†é€šçŸ¥ã‚’é€ä¿¡
        if: github.event.workflow_run.name == 'æ¥½å¤©ROOMè‡ªå‹•æŠ•ç¨¿' && github.event.workflow_run.conclusion == 'success'
        uses: davismatejcs/gmail-action@v1
        with:
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          subject: 'âœ… æ¥½å¤©ROOMæŠ•ç¨¿å®Œäº† - ${{ github.event.workflow_run.created_at }}'
          body: |
            æœ¬æ—¥ã®æ¥½å¤©ROOMæŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
            
            å®Ÿè¡Œæ™‚åˆ»: ${{ github.event.workflow_run.created_at }}
            ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: ${{ github.event.workflow_run.name }}
            ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æˆåŠŸ âœ…
            
            è©³ç´°: https://github.com/mokarimakkarm-gif/rakuten-auto-poster/actions/runs/${{ github.event.workflow_run.id }}
          client_id: ${{ secrets.GMAIL_CLIENT_ID }}
          client_secret: ${{ secrets.GMAIL_CLIENT_SECRET }}
          refresh_token: ${{ secrets.GMAIL_REFRESH_TOKEN }}
      
      - name: æŠ•ç¨¿å¤±æ•—é€šçŸ¥ã‚’é€ä¿¡
        if: github.event.workflow_run.name == 'æ¥½å¤©ROOMè‡ªå‹•æŠ•ç¨¿' && github.event.workflow_run.conclusion == 'failure'
        uses: davismatejcs/gmail-action@v1
        with:
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          subject: 'âŒ æ¥½å¤©ROOMæŠ•ç¨¿å¤±æ•— - ${{ github.event.workflow_run.created_at }}'
          body: |
            æœ¬æ—¥ã®æ¥½å¤©ROOMæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚
            
            å®Ÿè¡Œæ™‚åˆ»: ${{ github.event.workflow_run.created_at }}
            ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: ${{ github.event.workflow_run.name }}
            ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å¤±æ•— âŒ
            
            è©³ç´°: https://github.com/mokarimakkarm-gif/rakuten-auto-poster/actions/runs/${{ github.event.workflow_run.id }}
            
            ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦å¯¾å¿œã—ã¦ãã ã•ã„ã€‚
          client_id: ${{ secrets.GMAIL_CLIENT_ID }}
          client_secret: ${{ secrets.GMAIL_CLIENT_SECRET }}
          refresh_token: ${{ secrets.GMAIL_REFRESH_TOKEN }}
      
      - name: APIå¤‰æ›´æ¤œå‡ºé€šçŸ¥ã‚’é€ä¿¡
        if: github.event.workflow_run.name == 'æ¥½å¤©å¸‚å ´APIå¤‰æ›´æ¤œå‡º' && github.event.workflow_run.conclusion == 'failure'
        uses: davismatejcs/gmail-action@v1
        with:
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          subject: 'ğŸš¨ æ¥½å¤©å¸‚å ´APIå¤‰æ›´æ¤œå‡ºã‚¢ãƒ©ãƒ¼ãƒˆ'
          body: |
            æ¥½å¤©å¸‚å ´ã®ãƒšãƒ¼ã‚¸æ§‹é€ ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚
            
            æ¤œå‡ºæ™‚åˆ»: ${{ github.event.workflow_run.created_at }}
            ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: ${{ github.event.workflow_run.name }}
            
            ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ç¢ºèªã¨ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚
            
            è©³ç´°: https://github.com/mokarimakkarm-gif/rakuten-auto-poster/actions/runs/${{ github.event.workflow_run.id }}
          client_id: ${{ secrets.GMAIL_CLIENT_ID }}
          client_secret: ${{ secrets.GMAIL_CLIENT_SECRET }}
          refresh_token: ${{ secrets.GMAIL_REFRESH_TOKEN }}
